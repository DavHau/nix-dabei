name: "Fill Cache"
on:
  push:
    branches:
      - main
jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: cachix/install-nix-action@v17
      with:
        nix_path: nixpkgs=channel:nixos-unstable
    - uses: cachix/cachix-action@v10
      with:
        name: nix-dabei
        authToken: '${{ secrets.CACHIX_AUTH_TOKEN }}'
    - run: nix build .#toplevel
    - run: du -h $(nix-store -qR result) --max=0 -BM|sort -n
    - run: nix build .#dist
    - run: nix build .#kexec
    - run: du -Lh  result/*
